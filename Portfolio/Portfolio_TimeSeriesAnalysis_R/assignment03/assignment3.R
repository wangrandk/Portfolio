setwd("C:\\Users\\RAN\\OneDrive\\Documents\\Time_Series_Analysis")
dat <- read.table("assignment3data.txt")
x <- ts(dat,frequency=12,start=1995)
x <- x[,1]
x1 <- x[1:78]
x2 <- x[-(1:78)]
x3 <- ts(x1,frequency=12,start=1995)
ts.plot(x1)
var(x1)
mean(x1)
#seasonal decomposition
plot(stl(log(x3),s.window = "per", t.window = 101,na.action = na.omit))
par(mfrow=c(1,2),mar=c(3,3,1,1),mgp=c(2,0.7,0))
acf(x1)
pacf(x1)
diffx1=diff(x1,1,12)
par(mfrow=c(1,3))
ts.plot(diffx1)
acf(diffx1, na.action = na.omit)
pacf(diffx1, na.action = na.omit)

ar1model = arima(x1, order = c(1,0,1), method ="ML", seasonal = list(order = c(1, 1, 0), period = 12),include.mean=F,)
ar1model
ts.plot(ar1model$residuals,type="o")
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================e=rnorm(1500)
a=0.9
#for(i in 1000:1500) {y[i]=filter(e[i],filter=a,method="recursive")} 
y=filter(e,filter=a,method="recursive")
par(mfrow=c(1,2))
ts.plot(e)
x <- ts(e,frequency=12,start=1995)
plot(x)
plot(stl(log(x),s.window = "per", t.window = 1000))
qqnorm(y)
acf(y)

## ARMA structure for x; AR(1)
x.struct<-c(1,0,0)
## Estimate the model (check for convergence):
x.fit<-arima(x,order=x.struct, method="ML",include.mean=F)
## Filter x and y:
x.filt<-x-x.fit$coef[1]*c(0,x[1:(length(x)-1)])
y.filt<-y-x.fit$coef[1]*c(0,y[1:(length(y)-1)])
##Estimate SCCF for the filtered series:
acf(cbind(y.filt, x.filt),type="correlation",na.action = na.omit)
plot(x.fit$residual,x)
